---
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import { SITE_TITLE } from "../../consts";
import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";

export const getStaticPaths = (async ({ paginate }) => {
    const posts = (await getCollection("blog")).sort(
        (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
    );
    // ÊØèÈ°µÊòæÁ§∫ 12 ÁØáÊñáÁ´†
    return paginate(posts, { pageSize: 12 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead
            title={page.currentPage === 1
                ? "Student Side Hustle Blog | Make Money Online Tips & Guides - SideBuz"
                : `Blog - Page ${page.currentPage} | SideBuz`}
            description="Expert tips on side hustles, passive income ideas, and how to make money online as a student. Real strategies to earn money while in college."
        />
        <link rel="stylesheet" href="/src/styles/global.css" />
    </head>
    <body>
        <Header />

        <main>
            <section class="page-header">
                <div class="container">
                    <h1>üìö Blog</h1>
                    <p>
                        Tips, strategies, and inspiration for your income
                        journey.
                    </p>
                    {
                        page.lastPage > 1 && (
                            <p class="page-info">
                                Page {page.currentPage} of {page.lastPage} ‚Ä¢{" "}
                                {page.total} articles
                            </p>
                        )
                    }
                </div>
            </section>

            <section class="blog-list">
                <div class="container">
                    <ul class="posts-list">
                        {
                            page.data.map((post) => (
                                <li class="post-item">
                                    <a href={`/${post.id.replace(".md", "")}/`}>
                                        <article>
                                            <div class="post-meta">
                                                {post.data.category && (
                                                    <span class="post-category">
                                                        {post.data.category}
                                                    </span>
                                                )}
                                                <span class="post-date">
                                                    <FormattedDate
                                                        date={post.data.pubDate}
                                                    />
                                                </span>
                                            </div>
                                            <h2 class="post-title">
                                                {post.data.title}
                                            </h2>
                                            {post.data.description && (
                                                <p class="post-excerpt">
                                                    {post.data.description}
                                                </p>
                                            )}
                                        </article>
                                    </a>
                                </li>
                            ))
                        }
                    </ul>

                    {/* Pagination Navigation */}
                    {
                        page.lastPage > 1 && (
                            <nav
                                class="pagination"
                                aria-label="Blog pagination"
                            >
                                <div class="pagination-inner">
                                    {/* Previous Button */}
                                    {page.url.prev ? (
                                        <a
                                            href={page.url.prev}
                                            class="pagination-btn prev"
                                        >
                                            <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                width="20"
                                                height="20"
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                stroke="currentColor"
                                                stroke-width="2"
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                            >
                                                <polyline points="15 18 9 12 15 6" />
                                            </svg>
                                            Previous
                                        </a>
                                    ) : (
                                        <span class="pagination-btn prev disabled">
                                            <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                width="20"
                                                height="20"
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                stroke="currentColor"
                                                stroke-width="2"
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                            >
                                                <polyline points="15 18 9 12 15 6" />
                                            </svg>
                                            Previous
                                        </span>
                                    )}

                                    {/* Page Numbers */}
                                    <div class="pagination-numbers">
                                        {Array.from(
                                            { length: page.lastPage },
                                            (_, i) => i + 1,
                                        ).map((num) =>
                                            num === page.currentPage ? (
                                                <span class="pagination-num active">
                                                    {num}
                                                </span>
                                            ) : (
                                                <a
                                                    href={
                                                        num === 1
                                                            ? "/blog/"
                                                            : `/blog/${num}/`
                                                    }
                                                    class="pagination-num"
                                                >
                                                    {num}
                                                </a>
                                            ),
                                        )}
                                    </div>

                                    {/* Next Button */}
                                    {page.url.next ? (
                                        <a
                                            href={page.url.next}
                                            class="pagination-btn next"
                                        >
                                            Next
                                            <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                width="20"
                                                height="20"
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                stroke="currentColor"
                                                stroke-width="2"
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                            >
                                                <polyline points="9 18 15 12 9 6" />
                                            </svg>
                                        </a>
                                    ) : (
                                        <span class="pagination-btn next disabled">
                                            Next
                                            <svg
                                                xmlns="http://www.w3.org/2000/svg"
                                                width="20"
                                                height="20"
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                stroke="currentColor"
                                                stroke-width="2"
                                                stroke-linecap="round"
                                                stroke-linejoin="round"
                                            >
                                                <polyline points="9 18 15 12 9 6" />
                                            </svg>
                                        </span>
                                    )}
                                </div>
                            </nav>
                        )
                    }
                </div>
            </section>
        </main>

        <Footer />
    </body>
</html>

<style>
    .page-header {
        background: var(--bg-secondary);
        padding: 3rem 0;
        text-align: center;
        border-bottom: 1px solid var(--border-color);
    }

    .page-header .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 1.5rem;
    }

    .page-header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
    }

    .page-header p {
        color: var(--text-secondary);
        font-size: 1.1rem;
        margin: 0;
    }

    .page-info {
        margin-top: 0.75rem !important;
        font-size: 0.9rem !important;
        color: var(--text-muted) !important;
    }

    .blog-list {
        padding: 3rem 0;
    }

    .blog-list .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 1.5rem;
    }

    .posts-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .post-item {
        border-bottom: 1px solid var(--border-color);
        padding: 1.5rem 0;
    }

    .post-item:last-child {
        border-bottom: none;
    }

    .post-item a {
        text-decoration: none;
        display: block;
        transition: all 0.2s ease;
    }

    .post-item:hover {
        background: var(--bg-secondary);
        margin: 0 -1rem;
        padding: 1.5rem 1rem;
        border-radius: 8px;
    }

    .post-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 0.5rem;
    }

    .post-category {
        display: inline-block;
        padding: 0.2rem 0.6rem;
        background: #dbeafe;
        color: #1e40af;
        font-size: 0.75rem;
        font-weight: 600;
        border-radius: 50px;
    }

    .post-date {
        font-size: 0.85rem;
        color: var(--text-muted);
    }

    .post-title {
        font-size: 1.35rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0 0 0.5rem;
        line-height: 1.4;
    }

    .post-item:hover .post-title {
        color: var(--accent-primary);
    }

    .post-excerpt {
        color: var(--text-secondary);
        font-size: 0.95rem;
        line-height: 1.6;
        margin: 0;
    }

    /* Pagination Styles */
    .pagination {
        margin-top: 3rem;
        padding-top: 2rem;
        border-top: 1px solid var(--border-color);
    }

    .pagination-inner {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .pagination-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.6rem 1rem;
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--text-primary);
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        text-decoration: none;
        transition: all 0.2s ease;
    }

    .pagination-btn:hover:not(.disabled) {
        background: var(--accent-primary);
        color: white;
        border-color: var(--accent-primary);
    }

    .pagination-btn.disabled {
        opacity: 0.4;
        cursor: not-allowed;
    }

    .pagination-numbers {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        margin: 0 1rem;
    }

    .pagination-num {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--text-primary);
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.2s ease;
    }

    .pagination-num:hover:not(.active) {
        background: var(--bg-secondary);
    }

    .pagination-num.active {
        background: var(--accent-primary);
        color: white;
    }

    .pagination-ellipsis {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        color: var(--text-muted);
    }

    @media (max-width: 600px) {
        .page-header h1 {
            font-size: 2rem;
        }

        .post-title {
            font-size: 1.15rem;
        }

        .pagination-inner {
            gap: 0.5rem;
        }

        .pagination-btn {
            padding: 0.5rem 0.75rem;
            font-size: 0.85rem;
        }

        .pagination-btn span:not(.pagination-btn) {
            display: none;
        }

        .pagination-numbers {
            margin: 0 0.5rem;
        }

        .pagination-num {
            width: 36px;
            height: 36px;
            font-size: 0.85rem;
        }
    }
</style>
