---
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { SITE_TITLE } from "../../consts";
import { getCollection } from "astro:content";
import FormattedDate from "../../components/FormattedDate.astro";

export async function getStaticPaths() {
    const allPosts = await getCollection("blog");
    const categories = [
        ...new Set(allPosts.map((post) => post.data.category).filter(Boolean)),
    ];

    return categories.map((category) => ({
        params: { category: category?.toLowerCase().replace(/\s+/g, "-") },
        props: {
            categoryName: category,
            posts: allPosts
                .filter((post) => post.data.category === category)
                .sort(
                    (a, b) =>
                        b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
                ),
        },
    }));
}

const { categoryName, posts } = Astro.props;
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead
            title={`${categoryName} | ${SITE_TITLE}`}
            description={`Articles in ${categoryName} category`}
        />
        <link rel="stylesheet" href="/src/styles/global.css" />
    </head>
    <body>
        <Header />

        <main>
            <section class="page-header">
                <div class="container">
                    <span class="category-badge">{categoryName}</span>
                    <h1>ðŸ“‚ {categoryName}</h1>
                    <p>{posts.length} articles in this category</p>
                </div>
            </section>

            <section class="posts-section">
                <div class="container">
                    <ul class="posts-list">
                        {
                            posts.map((post) => (
                                <li class="post-item">
                                    <a href={`/${post.id.replace(".md", "")}/`}>
                                        <article>
                                            <span class="post-date">
                                                <FormattedDate
                                                    date={post.data.pubDate}
                                                />
                                            </span>
                                            <h2 class="post-title">
                                                {post.data.title}
                                            </h2>
                                        </article>
                                    </a>
                                </li>
                            ))
                        }
                    </ul>
                </div>
            </section>
        </main>

        <Footer />
    </body>
</html>

<style>
    .page-header {
        background: var(--bg-secondary);
        padding: 3rem 0;
        text-align: center;
        border-bottom: 1px solid var(--border-color);
    }

    .page-header .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 1.5rem;
    }

    .category-badge {
        display: inline-block;
        padding: 0.4rem 1rem;
        background: #dbeafe;
        color: #1e40af;
        font-size: 0.85rem;
        font-weight: 600;
        border-radius: 50px;
        margin-bottom: 1rem;
    }

    .page-header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
    }

    .page-header p {
        color: var(--text-muted);
        font-size: 1rem;
        margin: 0;
    }

    .posts-section {
        padding: 3rem 0;
    }

    .posts-section .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 1.5rem;
    }

    .posts-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .post-item {
        border-bottom: 1px solid var(--border-color);
        padding: 1.25rem 0;
    }

    .post-item:last-child {
        border-bottom: none;
    }

    .post-item a {
        text-decoration: none;
        display: block;
    }

    .post-item:hover {
        background: var(--bg-secondary);
        margin: 0 -1rem;
        padding: 1.25rem 1rem;
        border-radius: 8px;
    }

    .post-date {
        font-size: 0.85rem;
        color: var(--text-muted);
        display: block;
        margin-bottom: 0.25rem;
    }

    .post-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin: 0;
        line-height: 1.4;
    }

    .post-item:hover .post-title {
        color: var(--accent-primary);
    }

    @media (max-width: 600px) {
        .page-header h1 {
            font-size: 2rem;
        }

        .post-title {
            font-size: 1.1rem;
        }
    }
</style>
