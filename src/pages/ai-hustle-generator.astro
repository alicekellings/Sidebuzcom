---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import ResultAffiliateCTA from "../components/ResultAffiliateCTA.astro";
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead
            title="AI Side Hustle Generator | Get Personalized Ideas - SideBuz"
            description="Describe your interests and skills, and our AI will generate 3 personalized side hustle ideas perfect for students. Free AI-powered tool."
        />
    </head>
    <body>
        <Header />

        <main>
            <section class="generator-section">
                <div class="container">
                    <!-- Input Screen -->
                    <div id="input-screen" class="screen active">
                        <div class="intro-content">
                            <span class="ai-badge">ü§ñ AI-Powered</span>
                            <h1>üí° AI Side Hustle Generator</h1>
                            <p class="intro-description">
                                Tell us about yourself, and our AI will create
                                <strong>3 unique side hustle ideas</strong>
                                tailored just for you.
                            </p>

                            <div class="input-card">
                                <label for="user-input"
                                    >Describe your interests, skills, and
                                    situation:</label
                                >
                                <textarea
                                    id="user-input"
                                    placeholder="Example: I'm a computer science student who loves photography. I have about 10 hours per week and want to work from my dorm room..."
                                    rows="4"
                                    maxlength="500"></textarea>
                                <div class="char-count">
                                    <span id="char-count">0</span>/500
                                </div>
                            </div>

                            <div class="example-prompts">
                                <p>Try these:</p>
                                <button
                                    class="example-btn"
                                    data-text="I'm a marketing major who's good at writing. I have weekends free and want to earn $500/month."
                                >
                                    üìù Writing-focused
                                </button>
                                <button
                                    class="example-btn"
                                    data-text="I love creating videos and have a good phone camera. Looking for creative ways to earn money."
                                >
                                    üì± Video creator
                                </button>
                                <button
                                    class="example-btn"
                                    data-text="I'm studying business and want to start something entrepreneurial with minimal upfront costs."
                                >
                                    üíº Entrepreneurial
                                </button>
                            </div>

                            <button
                                id="generate-btn"
                                class="btn btn-primary btn-lg"
                                disabled
                            >
                                ‚ú® Generate My Ideas
                            </button>
                        </div>
                    </div>

                    <!-- Loading Screen -->
                    <div id="loading-screen" class="screen">
                        <div class="loading-content">
                            <div class="loading-spinner"></div>
                            <h2>üß† AI is brainstorming...</h2>
                            <p>
                                Creating personalized hustle ideas just for you
                            </p>
                            <div class="loading-steps">
                                <div class="step" id="step-1">
                                    üîç Analyzing your profile...
                                </div>
                                <div class="step" id="step-2">
                                    üí° Generating unique ideas...
                                </div>
                                <div class="step" id="step-3">
                                    üìä Calculating earnings potential...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Results Screen -->
                    <div id="results-screen" class="screen">
                        <div class="results-content">
                            <h2>üéâ Your Personalized Side Hustles</h2>
                            <p class="results-subtitle">
                                Based on your unique profile, here are 3 ideas
                                perfect for you:
                            </p>

                            <ResultAffiliateCTA
                                heading="üí∞ Start Earning Today"
                            />

                            <div id="hustles-container" class="hustles-grid">
                                <!-- AI-generated hustles will be inserted here -->
                            </div>

                            <div class="results-cta">
                                <p>Ready to dive deeper?</p>
                                <a
                                    href="/student-income-finder"
                                    class="btn btn-secondary"
                                >
                                    üéØ Take Full Assessment
                                </a>
                                <button
                                    id="try-again-btn"
                                    class="btn btn-outline"
                                >
                                    üîÑ Generate New Ideas
                                </button>
                            </div>

                            <div class="affiliate-disclosure">
                                <p>
                                    üí° <strong>Pro Tip:</strong> These are AI-generated
                                    suggestions based on your input. For a more detailed
                                    analysis, try our full
                                    <a href="/student-income-finder"
                                        >Student Income Finder</a
                                    > quiz.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <Footer />
    </body>
</html>

<script>
    // DOM Elements
    const inputScreen = document.getElementById("input-screen");
    const loadingScreen = document.getElementById("loading-screen");
    const resultsScreen = document.getElementById("results-screen");
    const userInput = document.getElementById(
        "user-input",
    ) as HTMLTextAreaElement;
    const generateBtn = document.getElementById("generate-btn");
    const tryAgainBtn = document.getElementById("try-again-btn");
    const charCount = document.getElementById("char-count");
    const hustlesContainer = document.getElementById("hustles-container");

    // Example prompt buttons
    document.querySelectorAll(".example-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
            const text = btn.getAttribute("data-text") || "";
            userInput.value = text;
            updateCharCount();
            updateGenerateButton();
        });
    });

    // Character count
    userInput?.addEventListener("input", () => {
        updateCharCount();
        updateGenerateButton();
    });

    function updateCharCount() {
        if (charCount) {
            charCount.textContent = String(userInput?.value.length || 0);
        }
    }

    function updateGenerateButton() {
        if (generateBtn) {
            (generateBtn as HTMLButtonElement).disabled =
                (userInput?.value.length || 0) < 20;
        }
    }

    // Generate button
    generateBtn?.addEventListener("click", async () => {
        const description = userInput?.value.trim();
        if (!description || description.length < 20) return;

        showScreen("loading");
        animateLoadingSteps();

        try {
            const response = await fetch("/api/generate-hustles", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ description }),
            });

            const data = await response.json();

            if (data.success && data.hustles) {
                displayHustles(data.hustles);
                showScreen("results");
            } else {
                throw new Error("Failed to generate");
            }
        } catch (error) {
            console.error("Error:", error);
            // Show fallback results
            displayHustles(getFallbackHustles());
            showScreen("results");
        }
    });

    // Try again
    tryAgainBtn?.addEventListener("click", () => {
        showScreen("input");
    });

    function showScreen(screen: string) {
        inputScreen?.classList.remove("active");
        loadingScreen?.classList.remove("active");
        resultsScreen?.classList.remove("active");

        if (screen === "input") inputScreen?.classList.add("active");
        if (screen === "loading") loadingScreen?.classList.add("active");
        if (screen === "results") resultsScreen?.classList.add("active");
    }

    function animateLoadingSteps() {
        const steps = document.querySelectorAll(".loading-steps .step");
        steps.forEach((step, i) => {
            setTimeout(() => {
                step.classList.add("active");
            }, i * 1000);
        });
    }

    function displayHustles(hustles: any[]) {
        if (!hustlesContainer) return;

        hustlesContainer.innerHTML = hustles
            .map(
                (h, i) => `
            <div class="hustle-card" style="animation-delay: ${i * 0.1}s">
                <div class="hustle-header">
                    <span class="hustle-emoji">${h.emoji || "üíº"}</span>
                    <h3>${h.name}</h3>
                </div>
                <p class="hustle-description">${h.description}</p>
                <div class="hustle-stats">
                    <div class="stat">
                        <span class="stat-icon">üí∞</span>
                        <span>${h.earnings}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-icon">‚è±Ô∏è</span>
                        <span>${h.timeNeeded}</span>
                    </div>
                    <div class="stat">
                        <span class="stat-icon">üìä</span>
                        <span class="difficulty-${h.difficulty?.toLowerCase() || "medium"}">${h.difficulty}</span>
                    </div>
                </div>
                <div class="first-step">
                    <strong>üöÄ First Step:</strong>
                    <p>${h.firstStep}</p>
                </div>
            </div>
        `,
            )
            .join("");
    }

    function getFallbackHustles() {
        return [
            {
                name: "Freelance Content Writing",
                emoji: "‚úçÔ∏è",
                earnings: "$200-$800/month",
                timeNeeded: "5-10 hours/week",
                difficulty: "Easy",
                description:
                    "Turn your ideas into paid articles for blogs and websites.",
                firstStep:
                    "Create a profile on Medium and publish your first article today.",
            },
            {
                name: "Online Tutoring",
                emoji: "üìö",
                earnings: "$300-$1,000/month",
                timeNeeded: "5-15 hours/week",
                difficulty: "Medium",
                description:
                    "Help other students learn subjects you're good at.",
                firstStep:
                    "Sign up on tutoring platforms and set your availability.",
            },
            {
                name: "Social Media Management",
                emoji: "üì±",
                earnings: "$400-$1,200/month",
                timeNeeded: "10-20 hours/week",
                difficulty: "Medium",
                description:
                    "Help small businesses grow their online presence.",
                firstStep:
                    "Create sample posts and reach out to 3 local businesses.",
            },
        ];
    }
</script>

<style is:global>
    .generator-section {
        min-height: 80vh;
        padding: 2rem 0;
    }

    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 1.5rem;
    }

    .screen {
        display: none;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .screen.active {
        display: block;
        opacity: 1;
    }

    /* Intro/Input Screen */
    .intro-content {
        text-align: center;
        padding: 2rem 0;
    }

    .ai-badge {
        display: inline-block;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-size: 0.9rem;
        font-weight: 600;
        margin-bottom: 1rem;
    }

    .intro-content h1 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: var(--text-primary);
    }

    .intro-description {
        font-size: 1.15rem;
        color: var(--text-secondary);
        max-width: 600px;
        margin: 0 auto 2rem;
        line-height: 1.7;
    }

    .input-card {
        background: var(--bg-secondary);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        text-align: left;
    }

    .input-card label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: var(--text-primary);
    }

    .input-card textarea {
        width: 100%;
        padding: 1rem;
        border: 2px solid var(--border-color);
        border-radius: 12px;
        font-size: 1rem;
        font-family: inherit;
        resize: vertical;
        transition: border-color 0.2s;
    }

    .input-card textarea:focus {
        outline: none;
        border-color: var(--accent-primary);
    }

    .char-count {
        text-align: right;
        color: var(--text-muted);
        font-size: 0.85rem;
        margin-top: 0.5rem;
    }

    .example-prompts {
        margin-bottom: 2rem;
    }

    .example-prompts p {
        color: var(--text-muted);
        margin-bottom: 0.75rem;
    }

    .example-btn {
        background: white;
        border: 1px solid var(--border-color);
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-size: 0.85rem;
        margin: 0.25rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    .example-btn:hover {
        background: var(--bg-secondary);
        border-color: var(--accent-primary);
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 12px;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
    }

    .btn-lg {
        padding: 1rem 2rem;
        font-size: 1.1rem;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--accent-primary), #7c3aed);
        color: white;
    }

    .btn-primary:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(37, 99, 235, 0.3);
    }

    .btn-primary:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .btn-secondary {
        background: var(--accent-cta);
        color: white;
    }

    .btn-outline {
        background: transparent;
        border: 2px solid var(--border-color);
        color: var(--text-primary);
    }

    /* Loading Screen */
    .loading-content {
        text-align: center;
        padding: 4rem 0;
    }

    .loading-spinner {
        width: 60px;
        height: 60px;
        border: 4px solid var(--border-color);
        border-top-color: var(--accent-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 2rem;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .loading-content h2 {
        margin-bottom: 0.5rem;
    }

    .loading-steps {
        margin-top: 2rem;
    }

    .loading-steps .step {
        color: var(--text-muted);
        padding: 0.5rem;
        opacity: 0.5;
        transition: opacity 0.3s;
    }

    .loading-steps .step.active {
        opacity: 1;
        color: var(--accent-primary);
    }

    /* Results Screen */
    .results-content {
        padding: 2rem 0;
    }

    .results-content h2 {
        text-align: center;
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }

    .results-subtitle {
        text-align: center;
        color: var(--text-secondary);
        margin-bottom: 2rem;
    }

    .hustles-grid {
        display: grid;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .hustle-card {
        background: white;
        border: 1px solid var(--border-color);
        border-radius: 16px;
        padding: 1.5rem;
        animation: fadeInUp 0.4s ease both;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .hustle-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
    }

    .hustle-emoji {
        font-size: 2rem;
    }

    .hustle-header h3 {
        font-size: 1.25rem;
        color: var(--text-primary);
        margin: 0;
    }

    .hustle-description {
        color: var(--text-secondary);
        margin-bottom: 1rem;
        line-height: 1.6;
    }

    .hustle-stats {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }

    .stat {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    .difficulty-easy {
        color: #10b981;
    }
    .difficulty-medium {
        color: #f59e0b;
    }
    .difficulty-hard {
        color: #ef4444;
    }

    .first-step {
        background: var(--bg-secondary);
        padding: 1rem;
        border-radius: 8px;
        font-size: 0.95rem;
    }

    .first-step strong {
        color: var(--accent-primary);
    }

    .first-step p {
        margin: 0.5rem 0 0;
        color: var(--text-secondary);
    }

    .results-cta {
        text-align: center;
        padding: 2rem;
        background: var(--bg-secondary);
        border-radius: 16px;
        margin-bottom: 2rem;
    }

    .results-cta p {
        margin-bottom: 1rem;
        color: var(--text-secondary);
    }

    .results-cta .btn {
        margin: 0.5rem;
    }

    .affiliate-disclosure {
        text-align: center;
        padding: 1rem;
        background: #f0f9ff;
        border-radius: 8px;
        font-size: 0.9rem;
        color: var(--text-secondary);
    }

    .affiliate-disclosure a {
        color: var(--accent-primary);
    }

    @media (max-width: 768px) {
        .intro-content h1 {
            font-size: 1.75rem;
        }

        .hustle-stats {
            flex-direction: column;
            gap: 0.5rem;
        }

        .example-btn {
            display: block;
            width: 100%;
            margin: 0.5rem 0;
        }
    }
</style>
